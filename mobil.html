<!DOCTYPE html>
<html>
<head>
    <title>Tugas 2 - Animasi Mobil</title>
    <style>
        #content-wrapper {
            display: flex;
            flex-wrap: wrap; /* Membantu di layar kecil */
            gap: 10px;      /* Memberi jarak antar elemen */
        }
        canvas, video {
            border: 1px solid #ccc; /* Memberi batas agar terlihat */
        }
    </style>
</head>
<body>

<div id="content-wrapper">
    <canvas id="gl-canvas" width="512" height="512"> </canvas>
    
    <video src="video_objek.mp4" width="512" height="512" controls autoplay muted loop>
        Browser Anda tidak mendukung tag video.
    </video>
</div>

<img id="catTexture" 
     src="cat.jpeg" 
     style="display: none;">

<script id="vertex-shader" type="x-shader/x-vertex">
#version 300 es

in vec4 aPosition;
in vec4 aNormal;
in vec2 aTexCoord; // BARU: Input untuk koordinat tekstur

out vec3 N, L, E;
out vec2 vTexCoord; // BARU: Meneruskan koordinat tekstur ke fragment shader

uniform mat4 uModelViewMatrix; // Akan kita gunakan untuk ModelMatrix
uniform mat4 uViewMatrix;      // Matrix untuk Kamera
uniform mat4 uProjectionMatrix;
uniform vec4 uLightPosition;
uniform mat3 uNormalMatrix;

void main()
{
    // Kita pisahkan ModelView menjadi View dan Model
    // Ini lebih fleksibel untuk scene graph
    vec4 posView = uViewMatrix * uModelViewMatrix * aPosition;
    vec3 pos = posView.xyz;

    if(uLightPosition.w == 0.0) L = normalize(uLightPosition.xyz);
    else L = normalize( uLightPosition.xyz - pos );

    E =  -normalize(pos);
    
    // Hitung Normal Matrix dari ModelView
    // (Banyak library WebGL menyarankan ini dihitung di CPU)
    // Di sini kita hitung dari ModelViewMatrix
    N = normalize( uNormalMatrix * aNormal.xyz);

    vTexCoord = aTexCoord; // BARU: Teruskan UV
    gl_Position = uProjectionMatrix * posView;
}
</script>

<script id="fragment-shader" type="x-shader/x-fragment">
#version 300 es
precision mediump float;

uniform vec4 uAmbientProduct;
uniform vec4 uDiffuseProduct;
uniform vec4 uSpecularProduct;
uniform float uShininess;

// --- BARU ---
uniform sampler2D uTextureSampler; // Sampler untuk tekstur
uniform bool uUseTexture;         // Flag untuk mengaktifkan/menonaktifkan tekstur
in vec2 vTexCoord;                // Menerima UV dari vertex shader
// --- AKHIR BARU ---

in vec3 N, L, E;
out vec4 fColor;

void main()
{
    vec3 H = normalize( L + E );
    vec4 ambient = uAmbientProduct;

    float Kd = max( dot(L, N), 0.0 );
    vec4  diffuse = Kd*uDiffuseProduct;

    float Ks = pow( max(dot(N, H), 0.0), uShininess );
    vec4  specular = Ks * uSpecularProduct;

    if( dot(L, N) < 0.0 ) specular = vec4(0.0, 0.0, 0.0, 1.0);

    // --- MODIFIKASI ---
    vec4 baseColor = ambient + diffuse;
    
    if (uUseTexture) {
        vec4 texColor = texture(uTextureSampler, vTexCoord);
        baseColor = baseColor * texColor; // Modulasi warna dasar dengan tekstur
    }

    fColor = baseColor + specular; // Tambahkan specular (tidak diwarnai tekstur)
    fColor.a = 1.0;
    // --- AKHIR MODIFIKASI ---
}
</script>

<p>Kontrol Mobil:</p>
<button id = "ButtonForward">Maju</button>
<button id = "ButtonBackward">Mundur</button>
<button id = "ButtonTurnLeft">Belok Kiri</button>
<button id = "ButtonTurnRight">Belok Kanan</button>

<p>Kontrol Kamera (Opsional):</p>
<button id = "ButtonCamZoomIn">Zoom In</button>
<button id = "ButtonCamZoomOut">Zoom Out</button>

<p>Kontrol Cahaya (Light Marker):</p>
<label for="LightX">Light X: <span id="LightXVal">0.0</span></label>
<input type="range" id="LightX" min="-10" max="10" step="0.1" value="0">
<br/>
<label for="LightY">Light Y: <span id="LightYVal">0.0</span></label>
<input type="range" id="LightY" min="-10" max="10" step="0.1" value="0">

<p>Kontrol Body:</p>
<label for="HoodAngle">Hood (Kap) Angle: <span id="HoodAngleVal">0</span>°</label>
<input type="range" id="HoodAngle" min="0" max="45" step="1" value="0">
<br/>
<label for="TrunkAngle">Trunk (Bagasi) Angle: <span id="TrunkAngleVal">0</span>°</label>
<input type="range" id="TrunkAngle" min="0" max="45" step="1" value="0">
<br/>
<label for="RightDoorAngle">Right Front Door (Pintu Kanan Depan): <span id="RightDoorAngleVal">0</span>°</label>
<input type="range" id="RightDoorAngle" min="0" max="90" step="1" value="0">
<br/>
<label for="LeftDoorAngle">Left Front Door (Pintu Kiri Depan): <span id="LeftDoorAngleVal">0</span>°</label>
<input type="range" id="LeftDoorAngle" min="0" max="90" step="1" value="0">
<br/>
<label for="RightRearDoorAngle">Right Rear Door (Pintu Kanan Belakang): <span id="RightRearDoorAngleVal">0</span>°</label>
<input type="range" id="RightRearDoorAngle" min="0" max="90" step="1" value="0">
<br/>
<label for="LeftRearDoorAngle">Left Rear Door (Pintu Kiri Belakang): <span id="LeftRearDoorAngleVal">0</span>°</label>
<input type="range" id="LeftRearDoorAngle" min="0" max="90" step="1" value="0">

<p>Status:</p>
<div>Speed: <span id="SpeedVal">0.00</span> u/s</div>


<p>Keyboard:</p>
<ul>
    <li>Mobil: W/S maju-mundur, A/D belok</li>
    <li>Brake: E </li>
    <li>Reset: R</li>
    <li>Follow toggle: F</li>
    </ul>

<h3>Hierarchical Tree</h3>
<img id="hierTree" src="hirerichal_tree.jpg" alt="Hierarchical Tree" style="max-width: 100%; height: auto; border: 1px solid #ccc;" />

<script src="initShaders.js"></script>
<script src="MVnew.js"></script>
<script src="Wheels.js"></script>
<script src="MiddleBody.js"></script>
<script src="FrontnBack.js"></script>
<script src="Init.js"></script> </body>
</html>
